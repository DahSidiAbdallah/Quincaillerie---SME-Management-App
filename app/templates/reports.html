{% extends "base.html" %}
{% block title_key %}reports_page_title{% endblock %}
{% block title %}Rapports - SME Management{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .chart-container {
        position: relative;
        height: 400px;
        margin: 1rem 0;
    }
    
    .report-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .report-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    @media (max-width: 768px) {
        .chart-container {
            height: 300px;
        }
    }
</style>
{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8" x-data="reportsManager()">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900" data-i18n="reports_header">Rapports et Analytics</h1>
        <p class="text-gray-600 mt-2" data-i18n="reports_description">Analysez vos performances et générez des rapports détaillés</p>
    </div>

    <!-- Report Type Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div class="report-card bg-white rounded-lg shadow p-6" @click="generateReport('sales')">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-shopping-cart text-3xl text-blue-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Rapport de Ventes</h3>
                    <p class="text-sm text-gray-500">Analyse des ventes et revenus</p>
                </div>
            </div>
        </div>

        <div class="report-card bg-white rounded-lg shadow p-6" @click="generateReport('inventory')">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-boxes text-3xl text-green-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Rapport d'Inventaire</h3>
                    <p class="text-sm text-gray-500">État des stocks et valeurs</p>
                </div>
            </div>
        </div>

        <div class="report-card bg-white rounded-lg shadow p-6" @click="generateReport('financial')">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-chart-line text-3xl text-purple-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Rapport Financier</h3>
                    <p class="text-sm text-gray-500">Analyse financière complète</p>
                </div>
            </div>
        </div>

        <div class="report-card bg-white rounded-lg shadow p-6" @click="generateReport('customers')">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-users text-3xl text-yellow-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Analyse Clients</h3>
                    <p class="text-sm text-gray-500">Comportement et fidélité</p>
                </div>
            </div>
        </div>

        <div class="report-card bg-white rounded-lg shadow p-6" @click="generateReport('profit')">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-coins text-3xl text-orange-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Analyse des Profits</h3>
                    <p class="text-sm text-gray-500">Rentabilité par produit</p>
                </div>
            </div>
        </div>

        <div class="report-card bg-white rounded-lg shadow p-6" @click="activeTab = 'ai_insights'">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-brain text-3xl text-pink-600"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-gray-900">Insights IA</h3>
                    <p class="text-sm text-gray-500">Prédictions et recommandations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow mb-8">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6">
                <button @click="activeTab = 'analytics'" 
                        :class="activeTab === 'analytics' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-chart-bar mr-2"></i>Analytics
                </button>
                <button @click="activeTab = 'exports'" 
                        :class="activeTab === 'exports' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-download mr-2"></i>Exports
                </button>
                <button @click="activeTab = 'ai_insights'" 
                        :class="activeTab === 'ai_insights' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-brain mr-2"></i>IA Insights
                </button>
            </nav>
        </div>
    </div>

    <!-- Analytics Tab -->
    <div x-show="activeTab === 'analytics'" class="space-y-6">
        <!-- Date Range Filter -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex flex-wrap gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date de début</label>
                    <input type="date" x-model="dateRange.start" class="border border-gray-300 rounded-md px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date de fin</label>
                    <input type="date" x-model="dateRange.end" class="border border-gray-300 rounded-md px-3 py-2">
                </div>
                <button @click="loadAnalytics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                    <i class="fas fa-search mr-2"></i>Analyser
                </button>
            </div>
        </div>

        <!-- Analytics Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Ventes par Période</h3>
                <div class="chart-container">
                    <canvas id="salesAnalyticsChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Top Produits</h3>
                <div class="chart-container">
                    <canvas id="topProductsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Exports Tab -->
    <div x-show="activeTab === 'exports'" class="space-y-6">
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-6">Exporter les Données</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button @click="exportData('products')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-boxes text-2xl text-blue-600 mb-2"></i>
                    <span class="font-medium">Produits</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>

                <button @click="exportData('sales')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-shopping-cart text-2xl text-green-600 mb-2"></i>
                    <span class="font-medium">Ventes</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>

                <button @click="exportData('customers')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-users text-2xl text-yellow-600 mb-2"></i>
                    <span class="font-medium">Clients</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>

                <button @click="exportData('expenses')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-receipt text-2xl text-red-600 mb-2"></i>
                    <span class="font-medium">Dépenses</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>

                <button @click="exportData('debts')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-credit-card text-2xl text-purple-600 mb-2"></i>
                    <span class="font-medium">Créances</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>

                <button @click="exportData('ai_insights')" class="flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-brain text-2xl text-pink-600 mb-2"></i>
                    <span class="font-medium">Insights IA</span>
                    <span class="text-xs text-gray-500">Export CSV</span>
                </button>
            </div>
        </div>
    </div>

    <!-- AI Insights Tab -->
    <div x-show="activeTab === 'ai_insights'" class="space-y-6">
        <!-- AI Controls -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Insights Intelligence Artificielle</h3>
                <button @click="refreshAIInsights()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                    <i class="fas fa-sync mr-2"></i>Actualiser
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button @click="loadStockPredictions()" class="p-4 border border-gray-300 rounded-lg hover:bg-gray-50 text-left">
                    <i class="fas fa-chart-line text-blue-600 mb-2"></i>
                    <h4 class="font-medium">Prédictions Stock</h4>
                    <p class="text-xs text-gray-500">Alertes de rupture</p>
                </button>

                <button @click="loadSalesForecast()" class="p-4 border border-gray-300 rounded-lg hover:bg-gray-50 text-left">
                    <i class="fas fa-crystal-ball text-green-600 mb-2"></i>
                    <h4 class="font-medium">Prévisions Ventes</h4>
                    <p class="text-xs text-gray-500">Tendances futures</p>
                </button>

                <button @click="loadRestockSuggestions()" class="p-4 border border-gray-300 rounded-lg hover:bg-gray-50 text-left">
                    <i class="fas fa-truck text-purple-600 mb-2"></i>
                    <h4 class="font-medium">Suggestions Réappro</h4>
                    <p class="text-xs text-gray-500">Optimisation stock</p>
                </button>
            </div>
        </div>

        <!-- AI Results -->
        <div x-show="aiResults.type" class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900" x-text="aiResults.title">Résultats IA</h3>
                <span class="text-xs text-gray-500" x-text="aiResults.generated_at">Généré le</span>
            </div>
            
            <!-- Stock Predictions -->
            <div x-show="aiResults.type === 'stock_predictions'">
                <div class="space-y-4">
                    <template x-for="prediction in aiResults.data" :key="prediction.product_id">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-medium text-gray-900" x-text="prediction.product_name"></h4>
                                    <p class="text-sm text-gray-600" x-text="prediction.recommendation"></p>
                                </div>
                                <span class="px-2 py-1 text-xs font-medium rounded-full"
                                      :class="{
                                          'bg-red-100 text-red-800': prediction.alert_level === 'critical',
                                          'bg-yellow-100 text-yellow-800': prediction.alert_level === 'warning',
                                          'bg-blue-100 text-blue-800': prediction.alert_level === 'info'
                                      }"
                                      x-text="prediction.days_until_stockout + ' jours'">
                                </span>
                            </div>
                            <div class="mt-2 text-xs text-gray-500">
                                Stock actuel: <span x-text="prediction.current_stock"></span> | 
                                Consommation: <span x-text="prediction.daily_consumption"></span>/jour |
                                Confiance: <span x-text="Math.round(prediction.confidence * 100)"></span>%
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Sales Forecast -->
            <div x-show="aiResults.type === 'sales_forecast'">
                <div class="mb-4">
                    <p class="text-gray-600" x-text="aiResults.data.summary"></p>
                </div>
                <div class="chart-container">
                    <canvas id="forecastChart"></canvas>
                </div>
            </div>

            <!-- Restock Suggestions -->
            <div x-show="aiResults.type === 'restock_suggestions'">
                <div class="space-y-4">
                    <template x-for="suggestion in aiResults.data" :key="suggestion.product_id">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-medium text-gray-900" x-text="suggestion.product_name"></h4>
                                    <p class="text-sm text-gray-600" x-text="suggestion.reasoning"></p>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-gray-900" x-text="suggestion.suggested_quantity + ' unités'"></div>
                                    <div class="text-sm text-gray-500" x-text="formatCurrency(suggestion.investment_required)"></div>
                                </div>
                            </div>
                            <div class="mt-2 flex justify-between text-xs text-gray-500">
                                <span>Priorité: <span x-text="suggestion.priority"></span></span>
                                <span>Ventes: <span x-text="suggestion.daily_sales_rate"></span>/jour</span>
                                <span>Profit: <span x-text="formatCurrency(suggestion.profit_per_unit)"></span>/unité</span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Filters -->
    <div x-show="activeTab === 'filters'" class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4" data-i18n="reports_filters">Filtres de Rapport</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Date de début</label>
                <input type="date" x-model="reportFilters.start_date" class="w-full border border-gray-300 rounded-md px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Date de fin</label>
                <input type="date" x-model="reportFilters.end_date" class="w-full border border-gray-300 rounded-md px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Grouper par</label>
                <select x-model="reportFilters.group_by" class="w-full border border-gray-300 rounded-md px-3 py-2">
                    <option value="day">Jour</option>
                    <option value="week">Semaine</option>
                    <option value="month">Mois</option>
                </select>
            </div>
        </div>
        
        <div class="flex justify-end mt-6">
            <button @click="generateCustomReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md" data-i18n="reports_generate_report">
                <i class="fas fa-chart-bar mr-2"></i>Générer Rapport
            </button>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
function reportsManager() {
    return {
        activeTab: 'analytics',
        dateRange: {
            start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            end: new Date().toISOString().split('T')[0]
        },
        reportFilters: {
            start_date: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            end_date: new Date().toISOString().split('T')[0],
            group_by: 'day'
        },
        aiResults: {
            type: null,
            title: '',
            data: [],
            generated_at: ''
        },
        salesAnalyticsChart: null,
        topProductsChart: null,
        forecastChart: null,
        
        init() {
            this.$nextTick(() => {
                this.initializeCharts();
                this.loadAnalytics();
            });
        },
        
        async initializeCharts() {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not available');
                return;
            }
            
            // Sales Analytics Chart
            const salesCtx = document.getElementById('salesAnalyticsChart');
            if (salesCtx) {
                this.salesAnalyticsChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Ventes',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return window.formatCurrency ? window.formatCurrency(value) : value;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Top Products Chart
            const topProductsCtx = document.getElementById('topProductsChart');
            if (topProductsCtx) {
                this.topProductsChart = new Chart(topProductsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6',
                                '#06B6D4', '#84CC16', '#F97316', '#EC4899', '#6366F1'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        },
        
        async loadAnalytics() {
            try {
                const params = new URLSearchParams({
                    start_date: this.dateRange.start,
                    end_date: this.dateRange.end
                });
                
                const response = await apiFetch(`/api/reports/dashboard-analytics?${params}`);
                if (response.success && response.analytics) {
                    this.updateAnalyticsCharts(response.analytics);
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
                this.showNotification('Erreur lors du chargement des analytics', 'error');
            }
        },
        
        updateAnalyticsCharts(analytics) {
            // Update sales trend chart
            if (this.salesAnalyticsChart && analytics.sales_trend) {
                const salesData = analytics.sales_trend;
                this.salesAnalyticsChart.data.labels = salesData.map(item => this.formatDate(item.date));
                this.salesAnalyticsChart.data.datasets[0].data = salesData.map(item => item.revenue);
                this.salesAnalyticsChart.update();
            }
            
            // Update top products chart
            if (this.topProductsChart && analytics.product_performance) {
                const topProducts = analytics.product_performance.slice(0, 10);
                this.topProductsChart.data.labels = topProducts.map(item => item.name);
                this.topProductsChart.data.datasets[0].data = topProducts.map(item => item.revenue);
                this.topProductsChart.update();
            }
        },
        
        async generateReport(type) {
            try {
                const params = new URLSearchParams({
                    start_date: this.reportFilters.start_date,
                    end_date: this.reportFilters.end_date,
                    group_by: this.reportFilters.group_by
                });
                
                let endpoint = '';
                switch (type) {
                    case 'sales':
                        endpoint = `/api/reports/sales-report?${params}`;
                        break;
                    case 'inventory':
                        endpoint = `/api/reports/inventory-report?${params}`;
                        break;
                    case 'financial':
                        endpoint = `/api/reports/financial-report?${params}`;
                        break;
                    case 'customers':
                        endpoint = `/api/reports/customer-analysis?${params}`;
                        break;
                    case 'profit':
                        endpoint = `/api/reports/profit-analysis?${params}`;
                        break;
                    default:
                        throw new Error('Type de rapport invalide');
                }
                
                window.open(endpoint, '_blank');
            } catch (error) {
                console.error('Error generating report:', error);
                this.showNotification('Erreur lors de la génération du rapport', 'error');
            }
        },
        
        async generateCustomReport() {
            try {
                const params = new URLSearchParams(this.reportFilters);
                window.open(`/api/reports/sales-report?${params}`, '_blank');
            } catch (error) {
                console.error('Error generating custom report:', error);
                this.showNotification('Erreur lors de la génération du rapport personnalisé', 'error');
            }
        },
        
        async exportData(type) {
            try {
                const params = new URLSearchParams({
                    start_date: this.reportFilters.start_date,
                    end_date: this.reportFilters.end_date
                });
                
                window.open(`/api/reports/export/${type}?${params}`, '_blank');
                this.showNotification(`Export ${type} démarré`, 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                this.showNotification('Erreur lors de l\'export', 'error');
            }
        },
        
        async refreshAIInsights() {
            this.aiResults = { type: null, title: '', data: [], generated_at: '' };
            this.showNotification('Insights IA actualisés', 'info');
        },
        
        async loadStockPredictions() {
            try {
                const response = await apiFetch('/api/ai/stock-predictions');
                if (response.success) {
                    this.aiResults = {
                        type: 'stock_predictions',
                        title: 'Prédictions de Stock',
                        data: response.predictions || [],
                        generated_at: this.formatDate(response.generated_at)
                    };
                }
            } catch (error) {
                console.error('Error loading stock predictions:', error);
                this.showNotification('Erreur lors du chargement des prédictions', 'error');
            }
        },
        
        async loadSalesForecast() {
            try {
                const response = await apiFetch('/api/ai/sales-forecast?days_ahead=14');
                if (response.success) {
                    this.aiResults = {
                        type: 'sales_forecast',
                        title: 'Prévisions de Ventes',
                        data: response.forecast,
                        generated_at: this.formatDate(response.generated_at)
                    };
                    
                    // Update forecast chart
                    this.$nextTick(() => {
                        this.updateForecastChart(response.forecast);
                    });
                }
            } catch (error) {
                console.error('Error loading sales forecast:', error);
                this.showNotification('Erreur lors du chargement des prévisions', 'error');
            }
        },
        
        async loadRestockSuggestions() {
            try {
                const response = await apiFetch('/api/ai/restock-suggestions');
                if (response.success) {
                    this.aiResults = {
                        type: 'restock_suggestions',
                        title: 'Suggestions de Réapprovisionnement',
                        data: response.suggestions || [],
                        generated_at: this.formatDate(response.generated_at)
                    };
                }
            } catch (error) {
                console.error('Error loading restock suggestions:', error);
                this.showNotification('Erreur lors du chargement des suggestions', 'error');
            }
        },
        
        updateForecastChart(forecast) {
            if (!this.forecastChart && typeof Chart !== 'undefined') {
                const ctx = document.getElementById('forecastChart');
                if (ctx) {
                    this.forecastChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Prévisions',
                                data: [],
                                borderColor: 'rgb(168, 85, 247)',
                                backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return window.formatCurrency ? window.formatCurrency(value) : value;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            if (this.forecastChart && forecast.forecast) {
                this.forecastChart.data.labels = forecast.forecast.map(item => this.formatDate(item.date));
                this.forecastChart.data.datasets[0].data = forecast.forecast.map(item => item.predicted_revenue);
                this.forecastChart.update();
            }
        },
        
        formatCurrency(amount) {
            return window.formatCurrency ? window.formatCurrency(amount) : `${amount} MRU`;
        },
        
        formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fr-FR');
        },
        
        showNotification(message, type = 'info') {
            if (window.showNotification) {
                window.showNotification(message, type);
            } else {
                alert(message);
            }
        }
    };
}
</script>
<style>
[x-cloak] { display: none !important; }
</style>
{% endblock %}