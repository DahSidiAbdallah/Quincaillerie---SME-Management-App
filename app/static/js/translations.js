// Centralized translation dictionary and helpers
window.translations = {
    fr: {
        app_title: "SME Management",
        system_description: "SystÃ¨me de Gestion - Connectez-vous Ã  votre compte",
        username_label: "Nom d'utilisateur",
        username_placeholder: "Entrez votre nom d'utilisateur",
        pin_label: "Code PIN",
        pin_placeholder: "Entrez votre PIN",
        pin_hint: "PIN par dÃ©faut admin: 1234 | EmployÃ©s: voir administrateur",
        login_button: "Se connecter",
        login_loading: "Connexion...",
        quick_login_title: "Connexion rapide (dÃ©monstration):",
        quick_login_admin: "ğŸ‘¤ Admin",
        quick_login_employee: "ğŸ‘· EmployÃ©",
        status_online: "En ligne",
        status_offline: "Hors ligne",
        nav_dashboard: "ğŸ“Š Tableau de bord",
        nav_inventory: "ğŸ“¦ Inventaire",
        nav_sales: "ğŸ’° Ventes",
        nav_customers: "ğŸ‘¥ Clients",
        nav_finance: "ğŸ’³ Finance",
        nav_reports: "ğŸ“ˆ Rapports",
        nav_admin: "âš™ï¸ Admin",
        settings: "âš™ï¸ ParamÃ¨tres",
        logout: "ğŸšª DÃ©connexion",
        logout_confirm: "ÃŠtes-vous sÃ»r de vouloir vous dÃ©connecter?",
        sync_status: "SynchronisÃ©",
        loading: "Chargement...",
        install_app: "Installer l'application",
        session_expiring: "Votre session va expirer dans 10 secondes. Vous serez dÃ©connectÃ©(e) bientÃ´t.",
        session_expired: "Session expirÃ©e. DÃ©connexion...",
        logout_error: "Erreur lors de la dÃ©connexion",
        mode_admin: "Administrateur",
        mode_employee: "EmployÃ©",
        mode_prefix: "Mode:",
        user_prefix: "Utilisateur:",
        login_error: "Erreur de connexion",
    login_error_connection: "Erreur de connexion. VÃ©rifiez votre connexion internet.",
    dashboard_title: "Tableau de bord",
    dashboard_overview: "Vue d'ensemble de votre activitÃ©, ventes et inventaire",
    dashboard_total_products: "Total Produits",
    dashboard_low_stock: "Stock Faible",
    dashboard_out_of_stock: "Rupture",
    dashboard_today_sales: "Ventes Aujourd'hui",
    dashboard_total_revenue: "Revenus Total",
    dashboard_sales_7days: "Ventes des 7 Derniers Jours",
    dashboard_sales_daily: "Journalier",
    dashboard_sales_weekly: "Hebdomadaire",
    dashboard_top_products: "Produits les Plus Vendus",
    dashboard_units_sold: "unitÃ©s vendues",
    dashboard_view_all_products: "Voir tous les produits â†’",
    dashboard_recent_activities: "ActivitÃ©s RÃ©centes",
    dashboard_no_recent_activity: "Aucune activitÃ© rÃ©cente",
    dashboard_view_more_activities: "Voir plus d'activitÃ©s â†’",
    dashboard_alerts_reminders: "Alertes & Rappels",
    dashboard_low_stock_alert: "Stock Faible",
    dashboard_low_stock_below_threshold: "produits sont en dessous du seuil d'alerte.",
    dashboard_view_low_stock_products: "Voir les produits â†’",
    dashboard_overdue_payments: "Paiements en Retard",
    dashboard_no_overdue_clients: "0 clients ont des paiements en retard",
    dashboard_view_overdue_payments: "Voir les crÃ©ances â†’",
    dashboard_system_status: "Ã‰tat du SystÃ¨me",
    dashboard_system_online: "SystÃ¨me en ligne",
    dashboard_last_sync: "DerniÃ¨re synchronisation: aujourd'hui",
    dashboard_ai_insights: "Insights IA",
    dashboard_ai_recommendations: "Recommandations intelligentes pour votre business",
    dashboard_sales_forecast: "PrÃ©diction de Ventes",
    dashboard_view_details: "Voir dÃ©tails â†’",
    dashboard_restock: "RÃ©approvisionnement",
    dashboard_view_suggestions: "Voir suggestions â†’",
    dashboard_price_optimization: "Optimisation Prix",
    dashboard_optimize: "Optimiser â†’"
    },
    ar: {
        app_title: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±",
        system_description: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© - Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ",
        username_label: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
        username_placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
        pin_label: "Ø±Ù…Ø² PIN",
        pin_placeholder: "Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² PIN",
        pin_hint: "PIN Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø´Ø±Ù: 1234 | Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†: Ø§Ø³Ø£Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±",
        login_button: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
        login_loading: "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...",
        quick_login_title: "ØªØ³Ø¬ÙŠÙ„ Ø³Ø±ÙŠØ¹ (Ø¹Ø±Ø¶):",
        quick_login_admin: "ğŸ‘¤ Ù…Ø´Ø±Ù",
        quick_login_employee: "ğŸ‘· Ù…ÙˆØ¸Ù",
        status_online: "Ù…ØªØµÙ„",
        status_offline: "ØºÙŠØ± Ù…ØªØµÙ„",
        nav_dashboard: "ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
        nav_inventory: "ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",
        nav_sales: "ğŸ’° Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",
        nav_customers: "ğŸ‘¥ Ø§Ù„Ø²Ø¨Ù†Ø§Ø¡",
        nav_finance: "ğŸ’³ Ø§Ù„Ù…Ø§Ù„ÙŠØ©",
        nav_reports: "ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",
        nav_admin: "âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        settings: "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        logout: "ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
        logout_confirm: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ",
        sync_status: "Ù…ØªØ²Ø§Ù…Ù†",
        loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
        install_app: "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",
        session_expiring: "Ø³ØªÙ†ØªÙ‡ÙŠ Ø¬Ù„Ø³ØªÙƒ Ø®Ù„Ø§Ù„ 10 Ø«ÙˆØ§Ù†Ù. Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.",
        session_expired: "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©. Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...",
        logout_error: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
        mode_admin: "Ù…Ø¯ÙŠØ±",
        mode_employee: "Ù…ÙˆØ¸Ù",
        mode_prefix: "Ø§Ù„ÙˆØ¶Ø¹:",
        user_prefix: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",
        login_error: "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    login_error_connection: "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.",
    dashboard_title: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
    dashboard_overview: "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù†Ø´Ø§Ø·ÙƒØŒ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†",
    dashboard_total_products: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
    dashboard_low_stock: "Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶",
    dashboard_out_of_stock: "Ù†ÙØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",
    dashboard_today_sales: "Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…",
    dashboard_total_revenue: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
    dashboard_sales_7days: "Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…",
    dashboard_sales_daily: "ÙŠÙˆÙ…ÙŠ",
    dashboard_sales_weekly: "Ø£Ø³Ø¨ÙˆØ¹ÙŠ",
    dashboard_top_products: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ù‹Ø§",
    dashboard_units_sold: "ÙˆØ­Ø¯Ø© Ù…Ø¨Ø§Ø¹Ø©",
    dashboard_view_all_products: "Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª â†’",
    dashboard_recent_activities: "Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©",
    dashboard_no_recent_activity: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø­Ø¯ÙŠØ«Ø©",
    dashboard_view_more_activities: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ù†Ø´Ø·Ø© â†’",
    dashboard_alerts_reminders: "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØªØ°ÙƒÙŠØ±Ø§Øª",
    dashboard_low_stock_alert: "Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶",
    dashboard_low_stock_below_threshold: "Ù…Ù†ØªØ¬Ø§Øª ØªØ­Øª Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.",
    dashboard_view_low_stock_products: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª â†’",
    dashboard_overdue_payments: "Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…ØªØ£Ø®Ø±Ø©",
    dashboard_no_overdue_clients: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…ØªØ£Ø®Ø±ÙˆÙ† ÙÙŠ Ø§Ù„Ø¯ÙØ¹",
    dashboard_view_overdue_payments: "Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† â†’",
    dashboard_system_status: "Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…",
    dashboard_system_online: "Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØµÙ„",
    dashboard_last_sync: "Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: Ø§Ù„ÙŠÙˆÙ…",
    dashboard_ai_insights: "Ø±Ø¤Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
    dashboard_ai_recommendations: "ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ© Ù„Ø¹Ù…Ù„Ùƒ",
    dashboard_sales_forecast: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",
    dashboard_view_details: "Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ â†’",
    dashboard_restock: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯",
    dashboard_view_suggestions: "Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª â†’",
    dashboard_price_optimization: "ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±",
    dashboard_optimize: "ØªØ­Ø³ÙŠÙ† â†’"
    }
};


// Add a loading overlay for language switching UX
if (!document.getElementById('lang-loading-overlay')) {
    const overlay = document.createElement('div');
    overlay.id = 'lang-loading-overlay';
    overlay.style.position = 'fixed';
    overlay.style.top = 0;
    overlay.style.left = 0;
    overlay.style.width = '100vw';
    overlay.style.height = '100vh';
    overlay.style.background = 'rgba(255,255,255,0.7)';
    overlay.style.display = 'none';
    overlay.style.zIndex = 9999;
    overlay.innerHTML = '<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;color:#333;"><span class="lang-spinner" style="display:inline-block;width:2rem;height:2rem;border:3px solid #ccc;border-top:3px solid #333;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem;"></span><div id="lang-loading-text">Loading...</div></div>';
    document.body.appendChild(overlay);
    // Add spinner animation
    const style = document.createElement('style');
    style.textContent = '@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}';
    document.head.appendChild(style);
}

window.currentLang = document.documentElement.lang || 'fr';

function t(key) {
    const langDict = window.translations[window.currentLang] || {};
    return langDict[key] || key;
}

function applyTranslations(lang) {
    // Show loading overlay
    const overlay = document.getElementById('lang-loading-overlay');
    if (overlay) {
        overlay.style.display = 'block';
        // Set loading text based on language
        let loadingText = 'Loading...';
        if (lang === 'ar') loadingText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        else if (lang === 'fr') loadingText = 'Chargement...';
        document.getElementById('lang-loading-text').textContent = loadingText;
    }

    setTimeout(() => {
        if (lang) {
            window.currentLang = lang;
        }
        const dir = window.currentLang === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.setAttribute('lang', window.currentLang);
        document.documentElement.setAttribute('dir', dir);

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (key) {
                el.textContent = t(key);
            }
        });

        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            const key = el.getAttribute('data-i18n-placeholder');
            if (key) {
                el.setAttribute('placeholder', t(key));
            }
        });

        // Hide loading overlay after translations are applied
        if (overlay) {
            setTimeout(() => { overlay.style.display = 'none'; }, 350);
        }
    }, 150);
}

window.t = t;
window.applyTranslations = applyTranslations;
